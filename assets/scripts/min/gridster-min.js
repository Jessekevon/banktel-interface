!function($,t,i,e){function s(t){return t[0]&&$.isPlainObject(t[0])?this.data=t[0]:this.el=t,this.isCoords=!0,this.coords={},this.init(),this}var r=s.prototype;r.init=function(){this.set(),this.original_coords=this.get()},r.set=function(t,i){var e=this.el;if(e&&!t&&(this.data=e.offset(),this.data.width=e.width(),this.data.height=e.height()),e&&t&&!i){var s=e.offset();this.data.top=s.top,this.data.left=s.left}var r=this.data;return this.coords.x1=r.left,this.coords.y1=r.top,this.coords.x2=r.left+r.width,this.coords.y2=r.top+r.height,this.coords.cx=r.left+r.width/2,this.coords.cy=r.top+r.height/2,this.coords.width=r.width,this.coords.height=r.height,this.coords.el=e||!1,this},r.update=function(t){if(!t&&!this.el)return this;if(t){var i=$.extend({},this.data,t);return this.data=i,this.set(!0,!0)}return this.set(!0),this},r.get=function(){return this.coords},$.fn.coords=function(){if(this.data("coords"))return this.data("coords");var t=new s(this,arguments[0]);return this.data("coords",t),t}}(jQuery,window,document),function($,t,i,e){function s(t,i,e){this.options=$.extend(r,e),this.$element=t,this.last_colliders=[],this.last_colliders_coords=[],"string"==typeof i||i instanceof jQuery?this.$colliders=$(i,this.options.colliders_context).not(this.$element):this.colliders=$(i),this.init()}var r={colliders_context:i.body},o=s.prototype;o.init=function(){this.find_collisions()},o.overlaps=function(t,i){var e=!1,s=!1;return(i.x1>=t.x1&&i.x1<=t.x2||i.x2>=t.x1&&i.x2<=t.x2||t.x1>=i.x1&&t.x2<=i.x2)&&(e=!0),(i.y1>=t.y1&&i.y1<=t.y2||i.y2>=t.y1&&i.y2<=t.y2||t.y1>=i.y1&&t.y2<=i.y2)&&(s=!0),e&&s},o.detect_overlapping_region=function(t,i){var e="",s="";return t.y1>i.cy&&t.y1<i.y2&&(e="N"),t.y2>i.y1&&t.y2<i.cy&&(e="S"),t.x1>i.cx&&t.x1<i.x2&&(s="W"),t.x2>i.x1&&t.x2<i.cx&&(s="E"),e+s||"C"},o.calculate_overlapped_area_coords=function(t,i){var e=Math.max(t.x1,i.x1),s=Math.max(t.y1,i.y1),r=Math.min(t.x2,i.x2),o=Math.min(t.y2,i.y2);return $({left:e,top:s,width:r-e,height:o-s}).coords().get()},o.calculate_overlapped_area=function(t){return t.width*t.height},o.manage_colliders_start_stop=function(t,i,e){for(var s=this.last_colliders_coords,r=0,o=s.length;o>r;r++)-1===$.inArray(s[r],t)&&i.call(this,s[r]);for(var a=0,n=t.length;n>a;a++)-1===$.inArray(t[a],s)&&e.call(this,t[a])},o.find_collisions=function(t){for(var i=this,e=[],s=[],r=this.colliders||this.$colliders,o=r.length,a=i.$element.coords().update(t||!1).get();o--;){var n=i.$colliders?$(r[o]):r[o],h=n.isCoords?n:n.coords(),_=h.get(),l=i.overlaps(a,_);if(l){var d=i.detect_overlapping_region(a,_);if("C"===d){var c=i.calculate_overlapped_area_coords(a,_),p=i.calculate_overlapped_area(c),g={area:p,area_coords:c,region:d,coords:_,player_coords:a,el:n};i.options.on_overlap&&i.options.on_overlap.call(this,g),e.push(h),s.push(g)}}}return(i.options.on_overlap_stop||i.options.on_overlap_start)&&this.manage_colliders_start_stop(e,i.options.on_overlap_stop,i.options.on_overlap_start),this.last_colliders_coords=e,s},o.get_closest_colliders=function(t){var i=this.find_collisions(t);return i.sort(function(t,i){return"C"===t.region&&"C"===i.region?t.coords.y1<i.coords.y1||t.coords.x1<i.coords.x1?-1:1:(t.area<i.area,1)}),i},$.fn.collision=function(t,i){return new s(this,t,i)}}(jQuery,window,document),function(t,i){t.debounce=function(t,i,e){var s;return function(){var r=this,o=arguments,a=function(){s=null,e||t.apply(r,o)};e&&!s&&t.apply(r,o),clearTimeout(s),s=setTimeout(a,i)}},t.throttle=function(t,i){var e,s,r,o,a,n,h=debounce(function(){a=o=!1},i);return function(){e=this,s=arguments;var _=function(){r=null,a&&t.apply(e,s),h()};return r||(r=setTimeout(_,i)),o?a=!0:n=t.apply(e,s),h(),o=!0,n}}}(window),function($,t,i,e){function s(t,e){this.options=$.extend({},r,e),this.$body=$(i.body),this.$container=$(t),this.$dragitems=$(this.options.items,this.$container),this.is_dragging=!1,this.player_min_left=0+this.options.offset_left,this.init()}var r={items:".gs_w",distance:1,limit:!0,offset_left:0,autoscroll:!0,ignore_dragging:["INPUT","TEXTAREA","SELECT","BUTTON"],handle:null},o=$(t),a=!!("ontouchstart"in t),n={start:a?"touchstart":"mousedown.draggable",move:a?"touchmove":"mousemove.draggable",end:a?"touchend":"mouseup.draggable"},h=s.prototype;h.init=function(){this.calculate_positions(),this.$container.css("position","relative"),this.disabled=!1,this.events(),$(t).bind("resize",throttle($.proxy(this.calculate_positions,this),200))},h.events=function(){this.$container.on("selectstart",$.proxy(this.on_select_start,this)),this.$container.on(n.start,this.options.items,$.proxy(this.drag_handler,this)),this.$body.on(n.end,$.proxy(function(t){this.is_dragging=!1,this.disabled||(this.$body.off(n.move),this.drag_start&&this.on_dragstop(t))},this))},h.get_actual_pos=function(t){var i=t.position();return i},h.get_mouse_pos=function(t){if(a){var i=t.originalEvent;t=i.touches.length?i.touches[0]:i.changedTouches[0]}return{left:t.clientX,top:t.clientY}},h.get_offset=function(t){t.preventDefault();var i=this.get_mouse_pos(t),e=Math.round(i.left-this.mouse_init_pos.left),s=Math.round(i.top-this.mouse_init_pos.top),r=Math.round(this.el_init_offset.left+e-this.baseX),o=Math.round(this.el_init_offset.top+s-this.baseY+this.scrollOffset);return this.options.limit&&(r>this.player_max_left?r=this.player_max_left:r<this.player_min_left&&(r=this.player_min_left)),{left:r,top:o,mouse_left:i.left,mouse_top:i.top}},h.manage_scroll=function(t){var i,e=o.scrollTop(),s=e,r=s+this.window_height,a=r-50,n=s+50,h=t.mouse_left,_=s+t.mouse_top,l=this.doc_height-this.window_height+this.player_height;_>=a&&(i=e+30,l>i&&(o.scrollTop(i),this.scrollOffset=this.scrollOffset+30)),n>=_&&(i=e-30,i>0&&(o.scrollTop(i),this.scrollOffset=this.scrollOffset-30))},h.calculate_positions=function(t){this.window_height=o.height()},h.drag_handler=function(t){var i=t.target.nodeName;if(!this.disabled&&(1===t.which||a)&&!this.ignore_drag(t)){var e=this,s=!0;return this.$player=$(t.currentTarget),this.el_init_pos=this.get_actual_pos(this.$player),this.mouse_init_pos=this.get_mouse_pos(t),this.offsetY=this.mouse_init_pos.top-this.el_init_pos.top,this.$body.on(n.move,function(t){var i=e.get_mouse_pos(t),r=Math.abs(i.left-e.mouse_init_pos.left),o=Math.abs(i.top-e.mouse_init_pos.top);return r>e.options.distance||o>e.options.distance?s?(s=!1,e.on_dragstart.call(e,t),!1):(e.is_dragging===!0&&e.on_dragmove.call(e,t),!1):!1}),!1}},h.on_dragstart=function(t){t.preventDefault(),this.drag_start=!0,this.is_dragging=!0;var e=this.$container.offset();return this.baseX=Math.round(e.left),this.baseY=Math.round(e.top),this.doc_height=$(i).height(),"clone"===this.options.helper?(this.$helper=this.$player.clone().appendTo(this.$container).addClass("helper"),this.helper=!0):this.helper=!1,this.scrollOffset=0,this.el_init_offset=this.$player.offset(),this.player_width=this.$player.width(),this.player_height=this.$player.height(),this.player_max_left=this.$container.width()-this.player_width+this.options.offset_left,this.options.start&&this.options.start.call(this.$player,t,{helper:this.helper?this.$helper:this.$player}),!1},h.on_dragmove=function(t){var i=this.get_offset(t);this.options.autoscroll&&this.manage_scroll(i),(this.helper?this.$helper:this.$player).css({position:"absolute",left:i.left,top:i.top});var e={position:{left:i.left,top:i.top}};return this.options.drag&&this.options.drag.call(this.$player,t,e),!1},h.on_dragstop=function(t){var i=this.get_offset(t);this.drag_start=!1;var e={position:{left:i.left,top:i.top}};return this.options.stop&&this.options.stop.call(this.$player,t,e),this.helper&&this.$helper.remove(),!1},h.on_select_start=function(t){return this.disabled||this.ignore_drag(t)?void 0:!1},h.enable=function(){this.disabled=!1},h.disable=function(){this.disabled=!0},h.destroy=function(){this.disable(),$.removeData(this.$container,"drag")},h.ignore_drag=function(t){return this.options.handle?!$(t.target).is(this.options.handle):$.inArray(t.target.nodeName,this.options.ignore_dragging)>=0},$.fn.drag=function(t){return this.each(function(){$.data(this,"drag")||$.data(this,"drag",new s(this,t))})}}(jQuery,window,document),function($,t,i,e){function s(t,i){this.options=$.extend(!0,r,i),this.$el=$(t),this.$wrapper=this.$el.parent(),this.$widgets=this.$el.children(this.options.widget_selector).addClass("gs_w"),this.widgets=[],this.$changed=$([]),this.wrapper_width=this.$wrapper.width(),this.min_widget_width=2*this.options.widget_margins[0]+this.options.widget_base_dimensions[0],this.min_widget_height=2*this.options.widget_margins[1]+this.options.widget_base_dimensions[1],this.init()}var r={namespace:"",widget_selector:"li",widget_margins:[10,10],widget_base_dimensions:[400,225],extra_rows:0,extra_cols:0,min_cols:1,min_rows:15,max_size_x:6,autogenerate_stylesheet:!0,avoid_overlapped_widgets:!0,serialize_params:function(t,i){return{col:i.col,row:i.row,size_x:i.size_x,size_y:i.size_y}},collision:{},draggable:{distance:4}};s.generated_stylesheets=[];var o=s.prototype;o.init=function(){this.generate_grid_and_stylesheet(),this.get_widgets_from_DOM(),this.set_dom_grid_height(),this.$wrapper.addClass("ready"),this.draggable(),$(t).bind("resize",throttle($.proxy(this.recalculate_faux_grid,this),200))},o.disable=function(){return this.$wrapper.find(".player-revert").removeClass("player-revert"),this.drag_api.disable(),this},o.enable=function(){return this.drag_api.enable(),this},o.add_widget=function(t,i,e,s,r){var o;i||(i=1),e||(e=1),!s&!r?o=this.next_position(i,e):(o={col:s,row:r},this.empty_cells(s,r,i,e));var a=$(t).attr({"data-col":o.col,"data-row":o.row,"data-sizex":i,"data-sizey":e}).addClass("gs_w").appendTo(this.$el).hide();return this.$widgets=this.$widgets.add(a),this.register_widget(a),this.add_faux_rows(o.size_y),this.set_dom_grid_height(),a.fadeIn()},o.resize_widget=function(t,i,e){var s=t.coords().grid;i||(i=s.size_x),e||(e=s.size_y),i>this.cols&&(i=this.cols);var r=this.get_cells_occupied(s),o=s.size_x,a=s.size_y,n=s.col,h=n,_=i>o,l=e>a;if(n+i-1>this.cols){var d=n+(i-1)-this.cols,c=n-d;h=Math.max(1,c)}var p={col:h,row:s.row,size_x:i,size_y:e},g=this.get_cells_occupied(p),u=[];$.each(r.cols,function(t,i){-1===$.inArray(i,g.cols)&&u.push(i)});var f=[];$.each(g.cols,function(t,i){-1===$.inArray(i,r.cols)&&f.push(i)});var w=[];$.each(r.rows,function(t,i){-1===$.inArray(i,g.rows)&&w.push(i)});var y=[];if($.each(g.rows,function(t,i){-1===$.inArray(i,r.rows)&&y.push(i)}),this.remove_from_gridmap(s),f.length){var m=[h,s.row,i,Math.min(a,e),t];this.empty_cells.apply(this,m)}if(y.length){var v=[h,s.row,i,e,t];this.empty_cells.apply(this,v)}if(s.col=h,s.size_x=i,s.size_y=e,this.add_to_gridmap(p,t),t.data("coords").update({width:i*this.options.widget_base_dimensions[0]+(i-1)*this.options.widget_margins[0]*2,height:e*this.options.widget_base_dimensions[1]+(e-1)*this.options.widget_margins[1]*2}),e>a&&this.add_faux_rows(e-a),i>o&&this.add_faux_cols(i-o),t.attr({"data-col":h,"data-sizex":i,"data-sizey":e}),u.length){var x=[u[0],s.row,u.length,Math.min(a,e),t];this.remove_empty_cells.apply(this,x)}if(w.length){var b=[h,s.row,i,e,t];this.remove_empty_cells.apply(this,b)}return t},o.empty_cells=function(t,i,e,s,r){var o=this.widgets_below({col:t,row:i-s,size_x:e,size_y:s});return o.not(r).each($.proxy(function(t,e){var r=$(e).coords().grid;if(r.row<=i+s-1){var o=i+s-r.row;this.move_widget_down($(e),o)}},this)),this.set_dom_grid_height(),this},o.remove_empty_cells=function(t,i,e,s,r){var o=this.widgets_below({col:t,row:i,size_x:e,size_y:s});return o.not(r).each($.proxy(function(t,i){this.move_widget_up($(i),s)},this)),this.set_dom_grid_height(),this},o.next_position=function(t,i){t||(t=1),i||(i=1);for(var e=this.gridmap,s=e.length,r=[],o,a=1;s>a;a++){o=e[a].length;for(var n=1;o>=n;n++){var h=this.can_move_to({size_x:t,size_y:i},a,n);h&&r.push({col:a,row:n,size_y:i,size_x:t})}}return r.length?this.sort_by_row_and_col_asc(r)[0]:!1},o.remove_widget=function(t,i,e){var s=t instanceof jQuery?t:$(t),r=s.coords().grid;$.isFunction(i)&&(e=i,i=!1),this.cells_occupied_by_placeholder={},this.$widgets=this.$widgets.not(s);var o=this.widgets_below(s);this.remove_from_gridmap(r),s.fadeOut($.proxy(function(){s.remove(),i||o.each($.proxy(function(t,i){this.move_widget_up($(i),r.size_y)},this)),this.set_dom_grid_height(),e&&e.call(this,t)},this))},o.remove_all_widgets=function(t){return this.$widgets.each($.proxy(function(i,e){this.remove_widget(e,!0,t)},this)),this},o.serialize=function(t){t||(t=this.$widgets);var i=[];return t.each($.proxy(function(t,e){i.push(this.options.serialize_params($(e),$(e).coords().grid))},this)),i},o.serialize_changed=function(){return this.serialize(this.$changed)},o.register_widget=function(t){var i={col:parseInt(t.attr("data-col"),10),row:parseInt(t.attr("data-row"),10),size_x:parseInt(t.attr("data-sizex"),10),size_y:parseInt(t.attr("data-sizey"),10),el:t};return this.options.avoid_overlapped_widgets&&!this.can_move_to({size_x:i.size_x,size_y:i.size_y},i.col,i.row)&&(i=this.next_position(i.size_x,i.size_y),i.el=t,t.attr({"data-col":i.col,"data-row":i.row,"data-sizex":i.size_x,"data-sizey":i.size_y})),t.data("coords",t.coords()),t.data("coords").grid=i,this.add_to_gridmap(i,t),this},o.update_widget_position=function(t,i){return this.for_each_cell_occupied(t,function(t,e){return this.gridmap[t]?void(this.gridmap[t][e]=i):this}),this},o.remove_from_gridmap=function(t){return this.update_widget_position(t,!1)},o.add_to_gridmap=function(t,i){if(this.update_widget_position(t,i||t.el),t.el){var e=this.widgets_below(t.el);e.each($.proxy(function(t,i){this.move_widget_up($(i))},this))}},o.draggable=function(){var t=this,i=$.extend(!0,{},this.options.draggable,{offset_left:this.options.widget_margins[0],start:function(i,e){t.$widgets.filter(".player-revert").removeClass("player-revert"),t.$player=$(this),t.$helper="clone"===t.options.draggable.helper?$(e.helper):t.$player,t.helper=!t.$helper.is(t.$player),t.on_start_drag.call(t,i,e),t.$el.trigger("gridster:dragstart")},stop:function(i,e){t.on_stop_drag.call(t,i,e),t.$el.trigger("gridster:dragstop")},drag:throttle(function(i,e){t.on_drag.call(t,i,e),t.$el.trigger("gridster:drag")},60)});return this.drag_api=this.$el.drag(i).data("drag"),this},o.on_start_drag=function(t,i){this.$helper.add(this.$player).add(this.$wrapper).addClass("dragging"),this.$player.addClass("player"),this.player_grid_data=this.$player.coords().grid,this.placeholder_grid_data=$.extend({},this.player_grid_data),this.$el.css("height",this.$el.height()+this.player_grid_data.size_y*this.min_widget_height);var e=this.faux_grid,s=this.$player.data("coords").coords;this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data),this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data),this.last_cols=[],this.last_rows=[],this.collision_api=this.$helper.collision(e,this.options.collision),this.$preview_holder=$("<li />",{"class":"preview-holder","data-row":this.$player.attr("data-row"),"data-col":this.$player.attr("data-col"),css:{width:s.width,height:s.height}}).appendTo(this.$el),this.options.draggable.start&&this.options.draggable.start.call(this,t,i)},o.on_drag=function(t,i){if(null===this.$player)return!1;var e={left:i.position.left+this.baseX,top:i.position.top+this.baseY};this.colliders_data=this.collision_api.get_closest_colliders(e),this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column),this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row),this.helper&&this.$player&&this.$player.css({left:i.position.left,top:i.position.top}),this.options.draggable.drag&&this.options.draggable.drag.call(this,t,i)},o.on_stop_drag=function(t,i){this.$helper.add(this.$player).add(this.$wrapper).removeClass("dragging"),i.position.left=i.position.left+this.baseX,i.position.top=i.position.top+this.baseY,this.colliders_data=this.collision_api.get_closest_colliders(i.position),this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column),this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row),this.$player.addClass("player-revert").removeClass("player").attr({"data-col":this.placeholder_grid_data.col,"data-row":this.placeholder_grid_data.row}).css({left:"",top:""}),this.$changed=this.$changed.add(this.$player),this.cells_occupied_by_player=this.get_cells_occupied(this.placeholder_grid_data),this.set_cells_player_occupies(this.placeholder_grid_data.col,this.placeholder_grid_data.row),this.$player.coords().grid.row=this.placeholder_grid_data.row,this.$player.coords().grid.col=this.placeholder_grid_data.col,this.options.draggable.stop&&this.options.draggable.stop.call(this,t,i),this.$preview_holder.remove(),this.$player=null,this.$helper=null,this.placeholder_grid_data={},this.player_grid_data={},this.cells_occupied_by_placeholder={},this.cells_occupied_by_player={},this.set_dom_grid_height()},o.on_overlapped_column_change=function(t,i){if(this.colliders_data.length){var e=this.get_targeted_columns(this.colliders_data[0].el.data.col),s=this.last_cols.length,r=e.length,o;for(o=0;r>o;o++)-1===$.inArray(e[o],this.last_cols)&&(t||$.noop).call(this,e[o]);for(o=0;s>o;o++)-1===$.inArray(this.last_cols[o],e)&&(i||$.noop).call(this,this.last_cols[o]);return this.last_cols=e,this}},o.on_overlapped_row_change=function(t,i){if(this.colliders_data.length){var e=this.get_targeted_rows(this.colliders_data[0].el.data.row),s=this.last_rows.length,r=e.length,o;for(o=0;r>o;o++)-1===$.inArray(e[o],this.last_rows)&&(t||$.noop).call(this,e[o]);for(o=0;s>o;o++)-1===$.inArray(this.last_rows[o],e)&&(i||$.noop).call(this,this.last_rows[o]);this.last_rows=e}},o.set_player=function(t,i,e){var s=this;e||this.empty_cells_player_occupies();var r=e?{col:t}:s.colliders_data[0].el.data,o=r.col,a=i||r.row;this.player_grid_data={col:o,row:a,size_y:this.player_grid_data.size_y,size_x:this.player_grid_data.size_x},this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);var n=this.get_widgets_overlapped(this.player_grid_data),h=this.widgets_constraints(n);if(this.manage_movements(h.can_go_up,o,a),this.manage_movements(h.can_not_go_up,o,a),!n.length){var _=this.can_go_player_up(this.player_grid_data);_!==!1&&(a=_),this.set_placeholder(o,a)}return{col:o,row:a}},o.widgets_constraints=function(t){var i=$([]),e,s=[],r=[];return t.each($.proxy(function(t,e){var o=$(e),a=o.coords().grid;this.can_go_widget_up(a)?(i=i.add(o),s.push(a)):r.push(a)},this)),e=t.not(i),{can_go_up:this.sort_by_row_asc(s),can_not_go_up:this.sort_by_row_desc(r)}},o.sort_by_row_asc=function(t){return t=t.sort(function(t,i){return t.row||(t=$(t).coords().grid,i=$(i).coords().grid),t.row>i.row?1:-1})},o.sort_by_row_and_col_asc=function(t){return t=t.sort(function(t,i){return t.row>i.row||t.row===i.row&&t.col>i.col?1:-1})},o.sort_by_col_asc=function(t){return t=t.sort(function(t,i){return t.col>i.col?1:-1})},o.sort_by_row_desc=function(t){return t=t.sort(function(t,i){return t.row+t.size_y<i.row+i.size_y?1:-1})},o.manage_movements=function(t,i,e){return $.each(t,$.proxy(function(t,s){var r=s,o=r.el,a=this.can_go_widget_up(r);if(a)this.move_widget_to(o,a),this.set_placeholder(i,a+r.size_y);else{var n=this.can_go_player_up(this.player_grid_data);if(!n){var h=e+this.player_grid_data.size_y-r.row;this.move_widget_down(o,h),this.set_placeholder(i,e)}}},this)),this},o.is_player=function(t,i){if(i&&!this.gridmap[t])return!1;var e=i?this.gridmap[t][i]:t;return e&&(e.is(this.$player)||e.is(this.$helper))},o.is_player_in=function(t,i){var e=this.cells_occupied_by_player||{};return $.inArray(t,e.cols)>=0&&$.inArray(i,e.rows)>=0},o.is_placeholder_in=function(t,i){var e=this.cells_occupied_by_placeholder||{};return this.is_placeholder_in_col(t)&&$.inArray(i,e.rows)>=0},o.is_placeholder_in_col=function(t){var i=this.cells_occupied_by_placeholder||[];return $.inArray(t,i.cols)>=0},o.is_empty=function(t,i){return"undefined"!=typeof this.gridmap[t]&&"undefined"!=typeof this.gridmap[t][i]&&this.gridmap[t][i]===!1?!0:!1},o.is_occupied=function(t,i){return this.gridmap[t]&&this.gridmap[t][i]?!0:!1},o.is_widget=function(t,i){var e=this.gridmap[t];return e?(e=e[i],e?e:!1):!1},o.is_widget_under_player=function(t,i){return this.is_widget(t,i)?this.is_player_in(t,i):!1},o.get_widgets_under_player=function(t){t||(t=this.cells_occupied_by_player||{cols:[],rows:[]});var i=$([]);return $.each(t.cols,$.proxy(function(e,s){$.each(t.rows,$.proxy(function(t,e){this.is_widget(s,e)&&(i=i.add(this.gridmap[s][e]))},this))},this)),i},o.set_placeholder=function(t,i){var e=$.extend({},this.placeholder_grid_data),s=this.widgets_below({col:e.col,row:e.row,size_y:e.size_y,size_x:e.size_x}),r=t+e.size_x-1;r>this.cols&&(t-=r-t);var o=this.placeholder_grid_data.row<i,a=this.placeholder_grid_data.col!==t;this.placeholder_grid_data.col=t,this.placeholder_grid_data.row=i,this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data),this.$preview_holder.attr({"data-row":i,"data-col":t}),(o||a)&&s.each($.proxy(function(i,s){this.move_widget_up($(s),this.placeholder_grid_data.col-t+e.size_y)},this));var n=this.get_widgets_under_player(this.cells_occupied_by_placeholder);n.length&&n.each($.proxy(function(t,s){var r=$(s);this.move_widget_down(r,i+e.size_y-r.data("coords").grid.row)},this))},o.can_go_player_up=function(t){var i=t.row+t.size_y-1,e=!0,s=[],r=1e4,o=this.get_widgets_under_player();return this.for_each_column_occupied(t,function(t){var a=this.gridmap[t],n=i+1;for(s[t]=[];--n>0&&(this.is_empty(t,n)||this.is_player(t,n)||this.is_widget(t,n)&&a[n].is(o));)s[t].push(n),r=r>n?n:r;return 0===s[t].length?(e=!1,!0):void s[t].sort()}),e?this.get_valid_rows(t,s,r):!1},o.can_go_widget_up=function(t){var i=t.row+t.size_y-1,e=!0,s=[],r=1e4;return this.for_each_column_occupied(t,function(o){var a=this.gridmap[o];s[o]=[];for(var n=i+1;--n>0&&(!this.is_widget(o,n)||this.is_player_in(o,n)||a[n].is(t.el));)this.is_player(o,n)||this.is_placeholder_in(o,n)||this.is_player_in(o,n)||s[o].push(n),r>n&&(r=n);return 0===s[o].length?(e=!1,!0):void s[o].sort()}),e?this.get_valid_rows(t,s,r):!1},o.get_valid_rows=function(t,i,e){for(var s=t.row,r=t.row+t.size_y-1,o=t.size_y,a=e-1,n=[];++a<=r;){var h=!0;if($.each(i,function(t,i){$.isArray(i)&&-1===$.inArray(a,i)&&(h=!1)}),h===!0&&(n.push(a),n.length===o))break}var _=!1;return 1===o?n[0]!==s&&(_=n[0]||!1):n[0]!==s&&(_=this.get_consecutive_numbers_index(n,o)),_},o.get_consecutive_numbers_index=function(t,i){for(var e=t.length,s=[],r=!0,o=-1,a=0;e>a;a++){if(r||t[a]===o+1){if(s.push(a),s.length===i)break;r=!1}else s=[],r=!0;o=t[a]}return s.length>=i?t[s[0]]:!1},o.get_widgets_overlapped=function(){var t,i=$([]),e=[],s=this.cells_occupied_by_player.rows.slice(0);return s.reverse(),$.each(this.cells_occupied_by_player.cols,$.proxy(function(t,r){$.each(s,$.proxy(function(t,s){if(!this.gridmap[r])return!0;var o=this.gridmap[r][s];this.is_occupied(r,s)&&!this.is_player(o)&&-1===$.inArray(o,e)&&(i=i.add(o),e.push(o))},this))},this)),i},o.on_start_overlapping_column=function(t){this.set_player(t,!1)},o.on_start_overlapping_row=function(t){this.set_player(!1,t)},o.on_stop_overlapping_column=function(t){this.set_player(t,!1);var i=this;this.for_each_widget_below(t,this.cells_occupied_by_player.rows[0],function(t,e){i.move_widget_up(this,i.player_grid_data.size_y)})},o.on_stop_overlapping_row=function(t){this.set_player(!1,t);for(var i=this,e=this.cells_occupied_by_player.cols,s=0,r=e.length;r>s;s++)this.for_each_widget_below(e[s],t,function(t,e){i.move_widget_up(this,i.player_grid_data.size_y)})},o.move_widget_to=function(t,i){var e=this,s=t.coords().grid,r=i-s.row,o=this.widgets_below(t),a=this.can_move_to(s,s.col,i,t);return a===!1?!1:(this.remove_from_gridmap(s),s.row=i,this.add_to_gridmap(s),t.attr("data-row",i),this.$changed=this.$changed.add(t),o.each(function(t,i){var s=$(i),r=s.coords().grid,o=e.can_go_widget_up(r);o&&o!==r.row&&e.move_widget_to(s,o)}),this)},o.move_widget_up=function(t,i){var e=t.coords().grid,s=e.row,r=[],o=!0;return i||(i=1),this.can_go_up(t)?void this.for_each_column_occupied(e,function(e){if(-1===$.inArray(t,r)){var o=t.coords().grid,a=s-i;if(a=this.can_go_up_to_row(o,e,a),!a)return!0;var n=this.widgets_below(t);this.remove_from_gridmap(o),o.row=a,this.add_to_gridmap(o),t.attr("data-row",o.row),this.$changed=this.$changed.add(t),r.push(t),n.each($.proxy(function(t,e){this.move_widget_up($(e),i)},this))}}):!1},o.move_widget_down=function(t,i){var e=t.coords().grid,s=e.row,r=[],o=i;if(!t)return!1;if(-1===$.inArray(t,r)){var a=t.coords().grid,n=s+i,h=this.widgets_below(t);this.remove_from_gridmap(a),h.each($.proxy(function(t,i){var e=$(i),s=e.coords().grid,r=this.displacement_diff(s,a,o);r>0&&this.move_widget_down(e,r)},this)),a.row=n,this.update_widget_position(a,t),t.attr("data-row",a.row),this.$changed=this.$changed.add(t),r.push(t)}},o.can_go_up_to_row=function(t,i,e){var s=this.gridmap,r=!0,o=[],a=t.row,n;if(this.for_each_column_occupied(t,function(t){var i=s[t];for(o[t]=[],n=a;n--&&this.is_empty(t,n)&&!this.is_placeholder_in(t,n);)o[t].push(n);return o[t].length?void 0:(r=!1,!0)}),!r)return!1;for(n=e,n=1;a>n;n++){for(var h=!0,_=0,l=o.length;l>_;_++)o[_]&&-1===$.inArray(n,o[_])&&(h=!1);if(h===!0){r=n;break}}return r},o.displacement_diff=function(t,i,e){var s=t.row,r=[],o=i.row+i.size_y;this.for_each_column_occupied(t,function(t){for(var i=0,e=o;s>e;e++)this.is_empty(t,e)&&(i+=1);r.push(i)});var a=Math.max.apply(Math,r);return e-=a,e>0?e:0},o.widgets_below=function(t){var i=$.isPlainObject(t)?t:t.coords().grid,e=this,s=this.gridmap,r=i.row+i.size_y-1,o=$([]);return this.for_each_column_occupied(i,function(t){e.for_each_widget_below(t,r,function(t,i){return e.is_player(this)||-1!==$.inArray(this,o)?void 0:(o=o.add(this),!0)})}),this.sort_by_row_asc(o)},o.set_cells_player_occupies=function(t,i){return this.remove_from_gridmap(this.placeholder_grid_data),this.placeholder_grid_data.col=t,this.placeholder_grid_data.row=i,this.add_to_gridmap(this.placeholder_grid_data,this.$player),this},o.empty_cells_player_occupies=function(){return this.remove_from_gridmap(this.placeholder_grid_data),this},o.can_go_up=function(t){var i=t.coords().grid,e=i.row,s=e-1,r=this.gridmap,o=[],a=!0;return 1===e?!1:(this.for_each_column_occupied(i,function(t){var i=this.is_widget(t,s);return this.is_occupied(t,s)||this.is_player(t,s)||this.is_placeholder_in(t,s)||this.is_player_in(t,s)?(a=!1,!0):void 0}),a)},o.can_move_to=function(t,i,e,s){var r=this.gridmap,o=t.el,a={size_y:t.size_y,size_x:t.size_x,col:i,row:e},n=!0,h=i+t.size_x-1;return h>this.cols?!1:s&&s<e+t.size_y-1?!1:(this.for_each_cell_occupied(a,function(i,e){var s=this.is_widget(i,e);!s||t.el&&!s.is(o)||(n=!1)}),n)},o.get_targeted_columns=function(t){for(var i=(t||this.player_grid_data.col)+(this.player_grid_data.size_x-1),e=[],s=t;i>=s;s++)e.push(s);return e},o.get_targeted_rows=function(t){for(var i=(t||this.player_grid_data.row)+(this.player_grid_data.size_y-1),e=[],s=t;i>=s;s++)e.push(s);return e},o.get_cells_occupied=function(t){var i={cols:[],rows:[]},e;for(arguments[1]instanceof jQuery&&(t=arguments[1].coords().grid),e=0;e<t.size_x;e++){var s=t.col+e;i.cols.push(s)}for(e=0;e<t.size_y;e++){var r=t.row+e;i.rows.push(r)}return i},o.for_each_cell_occupied=function(t,i){return this.for_each_column_occupied(t,function(e){this.for_each_row_occupied(t,function(t){i.call(this,e,t)})}),this},o.for_each_column_occupied=function(t,i){for(var e=0;e<t.size_x;e++){var s=t.col+e;i.call(this,s,t)}},o.for_each_row_occupied=function(t,i){for(var e=0;e<t.size_y;e++){var s=t.row+e;i.call(this,s,t)}},o._traversing_widgets=function(t,i,e,s,r){var o=this.gridmap;if(o[e]){var a,n,h=t+"/"+i;if(arguments[2]instanceof jQuery){var _=arguments[2].coords().grid;e=_.col,s=_.row,r=arguments[3]}var l=[],d=s,c={"for_each/above":function(){for(;d--&&!(d>0&&this.is_widget(e,d)&&-1===$.inArray(o[e][d],l)&&(a=r.call(o[e][d],e,d),l.push(o[e][d]),a)););},"for_each/below":function(){for(d=s+1,n=o[e].length;n>d&&(!this.is_widget(e,d)||-1!==$.inArray(o[e][d],l)||(a=r.call(o[e][d],e,d),l.push(o[e][d]),!a));d++);}};c[h]&&c[h].call(this)}},o.for_each_widget_above=function(t,i,e){return this._traversing_widgets("for_each","above",t,i,e),this},o.for_each_widget_below=function(t,i,e){return this._traversing_widgets("for_each","below",t,i,e),this},o.get_highest_occupied_cell=function(){for(var t,i=this.gridmap,e=[],s=[],r=i.length-1;r>=1;r--)for(t=i[r].length-1;t>=1;t--)if(this.is_widget(r,t)){e.push(t),s[t]=r;break}var o=Math.max.apply(Math,e);return this.highest_occupied_cell={col:s[o],row:o},this.highest_occupied_cell},o.get_widgets_from=function(t,i){var e=this.gridmap,s=$();return t&&(s=s.add(this.$widgets.filter(function(){var i=$(this).attr("data-col");return i===t||i>t}))),i&&(s=s.add(this.$widgets.filter(function(){var t=$(this).attr("data-row");return t===i||t>i}))),s},o.set_dom_grid_height=function(){var t=this.get_highest_occupied_cell().row;return this.$el.css("height",t*this.min_widget_height),this},o.generate_stylesheet=function(t){var i="",e=this.options.max_size_x,r=0,o=0,a,n;t||(t={}),t.cols||(t.cols=this.cols),t.rows||(t.rows=this.rows),t.namespace||(t.namespace=this.options.namespace),t.widget_base_dimensions||(t.widget_base_dimensions=this.options.widget_base_dimensions),t.widget_margins||(t.widget_margins=this.options.widget_margins),t.min_widget_width=2*t.widget_margins[0]+t.widget_base_dimensions[0],t.min_widget_height=2*t.widget_margins[1]+t.widget_base_dimensions[1];var h=$.param(t);if($.inArray(h,s.generated_stylesheets)>=0)return!1;for(s.generated_stylesheets.push(h),a=t.cols;a>=0;a--)i+=t.namespace+' [data-col="'+(a+1)+'"] { left:'+(a*t.widget_base_dimensions[0]+a*t.widget_margins[0]+(a+1)*t.widget_margins[0])+"px;} ";for(a=t.rows;a>=0;a--)i+=t.namespace+' [data-row="'+(a+1)+'"] { top:'+(a*t.widget_base_dimensions[1]+a*t.widget_margins[1]+(a+1)*t.widget_margins[1])+"px;} ";for(var _=1;_<=t.rows;_++)i+=t.namespace+' [data-sizey="'+_+'"] { height:'+(_*t.widget_base_dimensions[1]+2*(_-1)*t.widget_margins[1])+"px;}";for(var l=1;e>=l;l++)i+=t.namespace+' [data-sizex="'+l+'"] { width:'+(l*t.widget_base_dimensions[0]+2*(l-1)*t.widget_margins[0])+"px;}";return this.add_style_tag(i)},o.add_style_tag=function(t){var e=i,s=e.createElement("style");return e.getElementsByTagName("head")[0].appendChild(s),s.setAttribute("type","text/css"),s.styleSheet?s.styleSheet.cssText=t:s.appendChild(i.createTextNode(t)),this},o.generate_faux_grid=function(t,i){this.faux_grid=[],this.gridmap=[];var e,s;for(e=i;e>0;e--)for(this.gridmap[e]=[],s=t;s>0;s--)this.add_faux_cell(s,e);return this},o.add_faux_cell=function(t,i){var e=$({left:this.baseX+(i-1)*this.min_widget_width,top:this.baseY+(t-1)*this.min_widget_height,width:this.min_widget_width,height:this.min_widget_height,col:i,row:t,original_col:i,original_row:t}).coords();return $.isArray(this.gridmap[i])||(this.gridmap[i]=[]),this.gridmap[i][t]=!1,this.faux_grid.push(e),this},o.add_faux_rows=function(t){for(var i=this.rows,e=i+(t||1),s=e;s>i;s--)for(var r=this.cols;r>=1;r--)this.add_faux_cell(s,r);return this.rows=e,this.options.autogenerate_stylesheet&&this.generate_stylesheet(),this},o.add_faux_cols=function(t){for(var i=this.cols,e=i+(t||1),s=i;e>s;s++)for(var r=this.rows;r>=1;r--)this.add_faux_cell(r,s);return this.cols=e,this.options.autogenerate_stylesheet&&this.generate_stylesheet(),this},o.recalculate_faux_grid=function(){var i=this.$wrapper.width();return this.baseX=($(t).width()-i)/2,this.baseY=this.$wrapper.offset().top,$.each(this.faux_grid,$.proxy(function(t,i){this.faux_grid[t]=i.update({left:this.baseX+(i.data.col-1)*this.min_widget_width,top:this.baseY+(i.data.row-1)*this.min_widget_height})},this)),this},o.get_widgets_from_DOM=function(){return this.$widgets.each($.proxy(function(t,i){this.register_widget($(i))},this)),this},o.generate_grid_and_stylesheet=function(){var i=this.$wrapper.width(),e=this.$wrapper.height(),s=Math.floor(i/this.min_widget_width)+this.options.extra_cols,r=this.$widgets.map(function(){
return $(this).attr("data-col")});r=Array.prototype.slice.call(r,0),r.length||(r=[0]);var o=Math.max.apply(Math,r),a=this.options.extra_rows;return this.$widgets.each(function(t,i){a+=+$(i).attr("data-sizey")}),this.cols=Math.max(o,s,this.options.min_cols),this.rows=Math.max(a,this.options.min_rows),this.baseX=($(t).width()-i)/2,this.baseY=this.$wrapper.offset().top,this.options.autogenerate_stylesheet&&this.generate_stylesheet(),this.generate_faux_grid(this.rows,this.cols)},$.fn.gridster=function(t){return this.each(function(){$(this).data("gridster")||$(this).data("gridster",new s(this,t))})},$.Gridster=o}(jQuery,window,document);